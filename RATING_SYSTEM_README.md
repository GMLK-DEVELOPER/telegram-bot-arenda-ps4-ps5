# üåü –°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ PlayStation –ê—Ä–µ–Ω–¥–∞

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ –∞—Ä–µ–Ω–¥—ã –∏–≥—Ä–æ–≤—ã—Ö –∫–æ–Ω—Å–æ–ª–µ–π.

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#Ô∏è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
- [üìä –ö–∞–∫ —Å–µ—Ä–≤–µ—Ä –≤—ã–¥–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é](#-–∫–∞–∫-—Å–µ—Ä–≤–µ—Ä-–≤—ã–¥–∞–µ—Ç-—Ä–µ–π—Ç–∏–Ω–≥-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- [üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏](#Ô∏è-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏-–≤-–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏)
- [üéØ –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã](#-—Å–∏—Å—Ç–µ–º–∞-–æ—Ü–µ–Ω–∫–∏-–¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã)
- [‚ù§Ô∏è –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏](#Ô∏è-—Å–∏—Å—Ç–µ–º–∞-–ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
- [üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤](#-–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-—Ä–µ–π—Ç–∏–Ω–≥–æ–≤)
- [üì° API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#-api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
- [üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–π—Ç–∏–Ω–≥–∞:
- **–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ (60% –≤–µ—Å–∞)** - —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∞—Ä–µ–Ω–¥—ã
- **–õ–æ—è–ª—å–Ω–æ—Å—Ç—å (40% –≤–µ—Å–∞)** - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞:
```
–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥ = (–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ √ó 0.6) + (–õ–æ—è–ª—å–Ω–æ—Å—Ç—å √ó 0.4)
```

### –°—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
| –°—Ç–∞—Ç—É—Å | –î–∏–∞–ø–∞–∑–æ–Ω –±–∞–ª–ª–æ–≤ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------------|-----------|
| üèÜ **Premium** | 80-100 | –ü—Ä–µ–º–∏—É–º –∫–ª–∏–µ–Ω—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏ |
| üë§ **Regular** | 50-79 | –û–±—ã—á–Ω—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –∫–ª–∏–µ–Ω—Ç |
| ‚ö†Ô∏è **Risk** | 0-49 | –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–ª–∏–µ–Ω—Ç, —Ç—Ä–µ–±—É—é—â–∏–π –≤–Ω–∏–º–∞–Ω–∏—è |

## üìä –ö–∞–∫ —Å–µ—Ä–≤–µ—Ä –≤—ã–¥–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### üîç –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞**
   ```python
   # –§–∞–π–ª: bot.py, —Å—Ç—Ä–æ–∫–∞ 128
   return 50  # –ë–∞–∑–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
   ```

2. **–†–∞—Å—á–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã** (—Ñ—É–Ω–∫—Ü–∏—è `calculate_discipline_score`)
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç 3 –∫—Ä–∏—Ç–µ—Ä–∏—è: –≤–æ–∑–≤—Ä–∞—Ç, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏, —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª
   - –ë–∞–∑–æ–≤—ã–π –±–∞–ª–ª: 50, –º–∞–∫—Å–∏–º—É–º: 100

3. **–†–∞—Å—á–µ—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏** (—Ñ—É–Ω–∫—Ü–∏—è `calculate_loyalty_score`)
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–µ–Ω–¥
   - –î–æ–±–∞–≤–ª—è–µ—Ç –±–æ–Ω—É—Å—ã –∑–∞ —Å—Ç–∞–∂ (6 –∏ 12 –º–µ—Å—è—Ü–µ–≤)
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç —É—á–∞—Å—Ç–∏–µ –≤ –∞–∫—Ü–∏—è—Ö

4. **–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç**
   ```python
   # –§–∞–π–ª: bot.py, —Å—Ç—Ä–æ–∫–∞ 290
   final_score = int((discipline * discipline_weight) + (loyalty * loyalty_weight))
   ```

### üì§ –í—ã–¥–∞—á–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ API

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/ratings/{user_id}`

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "rating": {
    "user_id": "762139684",
    "final_score": 70,
    "discipline": 50,
    "loyalty": 100,
    "status": "regular",
    "status_name": "–û–±—ã—á–Ω—ã–π",
    "user_name": "–ò–≤–∞–Ω",
    "username": "ivan123",
    "benefits": ["–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∞—Ä–µ–Ω–¥—ã"],
    "transactions_count": 15,
    "recent_transactions": [...]
  }
}
```

### ü§ñ –í Telegram –±–æ—Ç–µ

–†–µ–π—Ç–∏–Ω–≥ **—Å–∫—Ä—ã—Ç –æ—Ç –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (`bot.py:1147`), –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –¥–ª—è:
- –ü—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –ø–æ –∑–∞—è–≤–∫–∞–º –Ω–∞ –∞—Ä–µ–Ω–¥—É
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫ –ø—Ä–µ–º–∏—É–º –∫–ª–∏–µ–Ω—Ç–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### üì± –í Telegram –±–æ—Ç–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

#### –î–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é:
1. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É **"‚≠ê –†–µ–π—Ç–∏–Ω–≥–∏"** –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

#### –§—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

**1. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤**
```
üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º: 25

‚≠ê –ò–≤–∞–Ω (70)
‚≠ê –ü–µ—Ç—Ä (85)
‚ûñ –°–µ—Ä–≥–µ–π (–±–µ–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞)
```

**2. –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ**
```
‚≠ê –†–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ò–≤–∞–Ω

üèÜ –û–±—â–∏–π –±–∞–ª–ª: 70/100
üìè –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞: 50/100
‚ù§Ô∏è –õ–æ—è–ª—å–Ω–æ—Å—Ç—å: 100/100
üéñÔ∏è –°—Ç–∞—Ç—É—Å: –û–±—ã—á–Ω—ã–π

–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: 15
```

**3. –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å 4 —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:

| –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è | –í–ª–∏—è–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|------------|---------|-------------------|
| **üïê –í–æ–∑–≤—Ä–∞—Ç –≤–æ–≤—Ä–µ–º—è** | +10 –±–∞–ª–ª–æ–≤ | –ö–ª–∏–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª –∫–æ–Ω—Å–æ–ª—å —Ç–æ—á–Ω–æ –≤ —Å—Ä–æ–∫ |
| **‚è∞ –û–ø–æ–∑–¥–∞–Ω–∏–µ 1-24—á** | -20 –±–∞–ª–ª–æ–≤ | –ó–∞–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ —Å—É—Ç–æ–∫ |
| **üö´ –û–ø–æ–∑–¥–∞–Ω–∏–µ >24—á** | -30 –±–∞–ª–ª–æ–≤ | –°–µ—Ä—å–µ–∑–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ |
| **üíé –û—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** | +10 –±–∞–ª–ª–æ–≤ | –ö–æ–Ω—Å–æ–ª—å –≤–µ—Ä–Ω—É–ª–∏ –≤ –∏–¥–µ–∞–ª—å–Ω–æ–º –≤–∏–¥–µ |
| **‚ö†Ô∏è –ú–µ–ª–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã** | -15 –±–∞–ª–ª–æ–≤ | –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è |
| **‚ùå –ö—Ä—É–ø–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã** | -30 –±–∞–ª–ª–æ–≤ | –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø–æ–ª–æ–º–∫–∏ |
| **‚úÖ –ë–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π** | 0 –±–∞–ª–ª–æ–≤ | –°–æ–±–ª—é–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª |
| **üìù –ú–µ–ª–∫–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ** | -15 –±–∞–ª–ª–æ–≤ | –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è |
| **üî¥ –ö—Ä—É–ø–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ** | -30 –±–∞–ª–ª–æ–≤ | –°–µ—Ä—å–µ–∑–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª |

**4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤**
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

‚≠ê –° —Ä–µ–π—Ç–∏–Ω–≥–æ–º: 25
üèÜ Premium: 5 (20%)
üë§ Regular: 15 (60%)
‚ö†Ô∏è Risk: 5 (20%)

–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: 67.4

–¢–æ–ø-3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. üèÜ –ü–µ—Ç—Ä (85)
2. üèÜ –ê–Ω–Ω–∞ (82)  
3. üë§ –ò–≤–∞–Ω (78)
```

### üåê –í –≤–µ–± –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

#### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

**1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞**
```http
POST /api/ratings/transaction
Content-Type: application/json

{
  "user_id": "762139684",
  "rental_id": "rental_123",
  "return_timing": "on_time",
  "item_condition": "perfect", 
  "rule_compliance": "no_violations",
  "notes": "–û—Ç–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç"
}
```

**2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**
```http
POST /api/ratings/loyalty-bonus
Content-Type: application/json

{
  "user_id": "762139684",
  "bonus_type": "promotion_participation",
  "bonus_amount": 10,
  "comment": "–£—á–∞—Å—Ç–∏–µ –≤ –ª–µ—Ç–Ω–µ–π –∞–∫—Ü–∏–∏"
}
```

**3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–π—Ç–∏–Ω–≥–æ–≤**
```http
POST /api/ratings/settings
Content-Type: application/json

{
  "settings": {
    "discipline_weight": 0.7,
    "loyalty_weight": 0.3,
    "transactions_window": 10
  }
}
```

### üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏

#### –î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞:
1. **–ü–æ–æ—â—Ä–µ–Ω–∏–µ —Ö–æ—Ä–æ—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - –î–æ–±–∞–≤–ª—è—Ç—å "+10" –∑–∞ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
   - –û—Ç–º–µ—á–∞—Ç—å –æ—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏
   - –ù–∞—á–∏—Å–ª—è—Ç—å –±–æ–Ω—É—Å—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ –∞–∫—Ü–∏—è—Ö

2. **–†–∞–±–æ—Ç–∞ —Å –Ω–æ–≤—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏:**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥ 50 –±–∞–ª–ª–æ–≤
   - –ü–æ–æ—â—Ä—è—Ç—å –ø–µ—Ä–≤—ã–µ –∞—Ä–µ–Ω–¥—ã –±–æ–Ω—É—Å–∞–º–∏

#### –î–ª—è –ø–æ–Ω–∏–∂–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞:
1. **–ù–∞–∫–∞–∑–∞–Ω–∏–µ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è:**
   - "-30" –∑–∞ —Å–µ—Ä—å–µ–∑–Ω—ã–µ –æ–ø–æ–∑–¥–∞–Ω–∏—è
   - "-30" –∑–∞ –ø–æ–ª–æ–º–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
   - "-30" –∑–∞ –≥—Ä—É–±—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª

2. **–ì—Ä–∞–¥–∞—Ü–∏—è –Ω–∞–∫–∞–∑–∞–Ω–∏–π:**
   - –ú–µ–ª–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è: -15 –±–∞–ª–ª–æ–≤
   - –°—Ä–µ–¥–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è: -20 –±–∞–ª–ª–æ–≤  
   - –ö—Ä—É–ø–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è: -30 –±–∞–ª–ª–æ–≤

## üéØ –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏:

**1. –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞**
```python
"return_timing": {
  "on_time": 10,        # –í–æ–≤—Ä–µ–º—è
  "late_1_24h": -20,    # –û–ø–æ–∑–¥–∞–Ω–∏–µ 1-24 —á–∞—Å–∞
  "late_over_24h": -30  # –û–ø–æ–∑–¥–∞–Ω–∏–µ –±–æ–ª–µ–µ 24 —á–∞—Å–æ–≤
}
```

**2. –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏**  
```python
"item_condition": {
  "perfect": 10,        # –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  "minor_defects": -15, # –ú–µ–ª–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã
  "major_defects": -30  # –ö—Ä—É–ø–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã
}
```

**3. –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª**
```python
"rule_compliance": {
  "no_violations": 0,    # –ë–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π
  "minor_violation": -15, # –ú–µ–ª–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
  "major_violation": -30  # –ö—Ä—É–ø–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è  
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞:
1. –ë–µ—Ä—É—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°—É–º–º–∏—Ä—É—é—Ç—Å—è –±–∞–ª–ª—ã –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
3. –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∫ —à–∫–∞–ª–µ 0-100
4. –ë–∞–∑–æ–≤—ã–π –±–∞–ª–ª –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 50

## ‚ù§Ô∏è –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:

**1. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∞—Ä–µ–Ω–¥—ã**
- +5 –±–∞–ª–ª–æ–≤ –∑–∞ –∫–∞–∂–¥—É—é –∞—Ä–µ–Ω–¥—É
- –ú–∞–∫—Å–∏–º—É–º +30 –±–∞–ª–ª–æ–≤

**2. –£—á–∞—Å—Ç–∏–µ –≤ –∞–∫—Ü–∏—è—Ö**
- +10 –±–∞–ª–ª–æ–≤ –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–º–æ-–∞–∫—Ü–∏—è—Ö

**3. –°—Ç–∞–∂ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**  
- 6 –º–µ—Å—è—Ü–µ–≤: +10 –±–∞–ª–ª–æ–≤
- 12 –º–µ—Å—è—Ü–µ–≤: +20 –±–∞–ª–ª–æ–≤

### –†–∞—Å—á–µ—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:
```python
loyalty_score = min(100, repeat_rentals_bonus + promotion_bonus + tenure_bonus)
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

### –¢—Ä–∏–≥–≥–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

**1. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã**
```python
# bot.py:1480, bot.py:2928
update_rating_on_rental_completion(user_id, rental)
```

**2. –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞:**
```python
def update_rating_on_rental_completion(user_id, rental_data, return_condition='perfect', on_time=True):
    # –î–æ–±–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞:
    # - –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞  
    # - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏
    # - –ë–æ–Ω—É—Å –∑–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞—Ä–µ–Ω–¥—É
    # - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥
```

**3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏:**
- –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `rating_history`
- –¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `user_ratings`

## üì° API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

**1. –í—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏**
```http
GET /api/ratings
Response: { "success": true, "ratings": [...] }
```

**2. –†–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**  
```http
GET /api/ratings/{user_id}
Response: { "success": true, "rating": {...} }
```

**3. –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
```http  
GET /api/ratings/history
Response: { "success": true, "history": [...] }
```

**4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã**
```http
GET /api/ratings/settings  
Response: { "success": true, "settings": {...} }
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

**1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
```http
POST /api/ratings/transaction
Body: {
  "user_id": "string",
  "rental_id": "string", 
  "return_timing": "on_time|late_1_24h|late_over_24h",
  "item_condition": "perfect|minor_defects|major_defects",
  "rule_compliance": "no_violations|minor_violation|major_violation",
  "notes": "string"
}
```

**2. –ë–æ–Ω—É—Å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**
```http
POST /api/ratings/loyalty-bonus
Body: {
  "user_id": "string",
  "bonus_type": "string",
  "bonus_amount": number,
  "comment": "string"  
}
```

**3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫**
```http
POST /api/ratings/settings
Body: {
  "settings": {
    "discipline_weight": 0.6,
    "loyalty_weight": 0.4,
    "transactions_window": 5
  }
}
```

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –§–∞–π–ª: `data/ratings.json`

```json
{
  "settings": {
    "discipline_weight": 0.6,
    "loyalty_weight": 0.4, 
    "transactions_window": 5,
    "status_thresholds": {
      "premium": 80,
      "regular": 50,
      "risk": 0
    },
    "discipline_rules": {
      "return_timing": {
        "on_time": 10,
        "late_1_24h": -20,
        "late_over_24h": -30
      },
      "item_condition": {
        "perfect": 10,
        "minor_defects": -15,
        "major_defects": -30
      },
      "rule_compliance": {
        "no_violations": 0,
        "minor_violation": -15,
        "major_violation": -30
      }
    },
    "loyalty_rules": {
      "repeat_rentals": {
        "bonus_per_rental": 5,
        "max_bonus": 30
      },
      "promotion_participation": 10,
      "tenure_bonus": {
        "6_months": 10,
        "12_months": 20
      }
    }
  },
  "user_ratings": {
    "user_id": {
      "user_id": "762139684",
      "final_score": 70,
      "discipline": 50,
      "loyalty": 100,
      "status": "regular",
      "status_name": "–û–±—ã—á–Ω—ã–π",
      "calculated_at": "2025-08-20T18:45:31.720583"
    }
  },
  "rating_history": {
    "user_id": [
      {
        "user_id": "762139684",
        "final_score": 70,
        "discipline": 50,
        "loyalty": 100,
        "status": "regular",
        "status_name": "–û–±—ã—á–Ω—ã–π",
        "calculated_at": "2025-08-20T18:45:31.720583",
        "bonus_reason": "optional",
        "bonus_amount": 100
      }
    ]
  },
  "transactions": {
    "user_id": [
      {
        "id": "uuid",
        "user_id": "762139684",
        "rental_id": "rental_uuid",
        "return_timing": "on_time",
        "item_condition": "perfect",
        "rule_compliance": "no_violations", 
        "notes": "–û—Ç–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç",
        "created_at": "2025-08-20T18:45:31.720583",
        "created_by": "admin"
      }
    ]
  }
}
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
```python
# –ë–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ
"discipline_weight": 0.8,
"loyalty_weight": 0.2

# –ë–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏  
"discipline_weight": 0.4,
"loyalty_weight": 0.6
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
```python
# –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
"transactions_window": 10

# –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—å—à–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
"transactions_window": 3
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤:
```python
"status_thresholds": {
  "premium": 85,  # –°—Ç—Ä–æ–∂–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è Premium
  "regular": 60,  # –í—ã—à–µ –ø–ª–∞–Ω–∫–∞ –¥–ª—è Regular
  "risk": 0
}
```

## üéÆ –í–ª–∏—è–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

### –°–∫—Ä—ã—Ç–æ–µ –≤–ª–∏—è–Ω–∏–µ:
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏** - –∫–ª–∏–µ–Ω—Ç—ã —Å –≤—ã—Å–æ–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏** - –ø—Ä–µ–º–∏—É–º –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –±–æ–Ω—É—Å—ã
- **–†–µ—à–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** - —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –ø–æ —Å–ø–æ—Ä–Ω—ã–º —Å–ª—É—á–∞—è–º
- **–ö—Ä–µ–¥–∏—Ç –¥–æ–≤–µ—Ä–∏—è** - –∫–ª–∏–µ–Ω—Ç—ã —Å —Ö–æ—Ä–æ—à–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–µ –¥–æ–≤–µ—Ä–∏—è

### –ë—É–¥—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º–∏ –±–æ–Ω—É—Å–∞–º–∏
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–µ–º–∏—É–º –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Å–∏—Å—Ç–µ–º–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ Issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.